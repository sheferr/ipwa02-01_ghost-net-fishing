<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<script defer="defer"
	src="https://maps.google.com/maps/api/js?key=&amp;libraries=drawing&amp;callback=initMap"></script>
<h:head>
	<title>Ghost-Net-Fishing</title>

	<h:outputStylesheet library="webjars"
		name="primeflex/3.3.1/primeflex.min.css" />
	<h:outputStylesheet library="css" name="accordion.css" />
	<!-- Load external JavaScript -->
	<h:outputScript library="js" name="maps.js" />

</h:head>
<h:body style="margin: 0; padding: 0;">

	<p:splitter style="height: 100vh" widgetVar="splitter">
		<p:splitterPanel size="10" styleClass="scrollable-panel">
			<p:growl id="messages" showDetail="true" life="5000" />
			<h:form id="listForm" styleClass="scrollable-panel">

				<p:accordionPanel id="accordion"
					value="#{fishingNetController.continents}" var="cont"
					multiple="true" style="height:100%; width:100%; margin:0px;"
					styleClass="no-padding">

					<p:tab title="#{cont}" style="height:100%; width:100%;">
						<p:dataTable id="netsTable#{vs.index}"
							value="#{fishingNetController.getFishingNetsByContinent(cont)}"
							var="net" selection="#{fishingNetController.selectedNet}"
							rowKey="#{net.id}" selectionMode="single">
							<p:ajax event="rowSelect" update=":listForm:netDialog"
								oncomplete="PF('netDialogWid').show()" />
							<p:column headerText="ID">
								<h:outputText value="#{net.id}" />
							</p:column>
							<p:column headerText="Status">
								<h:outputText value="#{net.status}" />
							</p:column>
						</p:dataTable>
					</p:tab>
				</p:accordionPanel>
				<p:dialog id="netDialog" widgetVar="netDialogWid" modal="true"
					header="Info">
					<h:panelGrid columns="2" cellpadding="5">
						<h:outputText value="Breitengrad:" />
						<h:outputText value="#{fishingNetController.selectedNet.latitude}" />
						<h:outputText value="Längengrad:" />
						<h:outputText value="#{fishingNetController.selectedNet.longitude}" />
						<h:outputText value="Radius:" />
						<h:outputText value="#{fishingNetController.selectedNet.area}" />
						<h:outputText value="Status:" />
						<h:outputText value="#{fishingNetController.selectedNet.status}" />
						
						<h:outputText rendered="#{fishingNetController.showName}" value="Name:" />
						<p:inputText rendered="#{fishingNetController.showName}" id="name" value="#{fishingNetController.currentUser.name}">
							<p:ajax event="blur"
								listener="#{fishingNetController.onBlurAction}" process="@this"
								update="@none" />
						</p:inputText>

						<h:outputText rendered="#{fishingNetController.showNext}" value="Telefonnummer:" />
						<p:inputText rendered="#{fishingNetController.showNext}" id="mobile" value="#{fishingNetController.currentUser.mobile}" >
							<p:ajax event="blur"
								listener="#{fishingNetController.onBlurAction}" process="@this"
								update="@none" />
						</p:inputText>
					</h:panelGrid>
					
					<p:commandButton value="Verschollen"
						rendered="#{fishingNetController.showMissing}"
						action="#{fishingNetController.cancelFishingNet}" 
						process="@this :listForm:mobile :listForm:name"
						update=":listForm:accordion :listForm:netDialog messages"
						styleClass="ui-button-warning" />
					
					<p:commandButton value="#{fishingNetController.selectedNet.nextStatus}"
						rendered="#{fishingNetController.showNext}"	
						action="#{fishingNetController.processFishingNet}" 
						process="@this :listForm:mobile :listForm:name"
						update=":listForm:accordion :listForm:netDialog messages"
						styleClass="ui-button-success" />

				</p:dialog>
			</h:form>
		</p:splitterPanel>
		<p:splitterPanel minSize="90" size="80" style="overflow: hidden;">
			<h:form>
				<p:remoteCommand name="callOnStateChange" update="shapeDialog"
					action="#{fishingNetController.onAddingNewCircle}"
					oncomplete="PF('shapeDialogWid').show()">
					<f:param name="shapeType" />
					<f:param name="centerLat" />
					<f:param name="centerLng" />
					<f:param name="radius" />
				</p:remoteCommand>
			</h:form>
			<p:gmap widgetVar="myMap" id="maps" disableDefaultUI="true"
				center="51.1181141, 10.85998582" zoom="5" type="HYBRID"
				style="width: 100%; height: 100%;"
				model="#{fishingNetController.circlesView.circleModel}">
				<p:ajax event="overlaySelect"
					listener="#{fishingNetController.circleSelected}"
					update=":listForm:netDialog" oncomplete="PF('netDialogWid').show()" />
			</p:gmap>

			<p:dialog header="Neuer Eintrag" widgetVar="shapeDialogWid"
				id="shapeDialog" modal="true" closeOnEscape="true" resizable="false"
				onHide="console.log('loeschen!!')">
				<h:panelGrid columns="2" cellpadding="5">
					<h:outputText value="Breitengrad " />
					<p:inputText value="#{fishingNetController.fishingNet.latitude}">
						<p:ajax event="blur"
							listener="#{fishingNetController.onBlurAction}" process="@this"
							update="@none" />
					</p:inputText>
					<h:outputText value="Längengrad " />
					<p:inputText value="#{fishingNetController.fishingNet.longitude}"
						required="true">
						<p:ajax event="blur"
							listener="#{fishingNetController.onBlurAction}" process="@this"
							update="@none" />
					</p:inputText>
					<h:outputText value="Radius (km²)" />
					<p:inputText value="#{fishingNetController.fishingNet.area}"
						required="true">
						<p:ajax event="blur"
							listener="#{fishingNetController.onBlurAction}" process="@this"
							update="@none" />
					</p:inputText>
				</h:panelGrid>
				<p:commandButton value="Speichern"
					action="#{fishingNetController.saveNewFishingNet}"
					icon="pi pi-save" styleClass="ui-button-raised ui-button-secondary"
					oncomplete="PF('shapeDialogWid').hide()"
					update=":listForm:accordion" />
			</p:dialog>

		</p:splitterPanel>

	</p:splitter>

</h:body>
</html>