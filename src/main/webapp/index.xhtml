<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="jakarta.faces.html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="jakarta.faces.core"
	xmlns:ui="jakarta.faces.facelets">

<h:head>
	<title>Ghost-Net-Fishing</title>

	<h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css" />
	<h:outputStylesheet library="css" name="accordion.css" />
	<!-- Load external JavaScript -->
	<h:outputScript target="body" library="js" name="maps.js" />

</h:head>
<h:body style="margin: 0; padding: 0;">

	<p:splitter style="height: 100vh" widgetVar="splitter">
	
		<!-- Left side of the website -->
		<p:splitterPanel size="10" styleClass="scrollable-panel">
			<p:growl id="messages" showDetail="true" life="5000" />
			<h:form id="listForm" styleClass="scrollable-panel">

				<!-- List of circles sorted by continent  -->
				<p:accordionPanel id="accordion"
					value="#{fishingNetController.continents}" var="cont"
					multiple="true" style="height:100%; width:100%; margin:0px;"
					styleClass="no-padding">

					<p:tab title="#{cont}" style="height:100%; width:100%;">
						<p:dataTable id="netsTable#{vs.index}"
							value="#{fishingNetController.getFishingNetsByContinent(cont)}"
							var="net" selection="#{fishingNetController.selectedNet}"
							rowKey="#{net.id}" selectionMode="single">
							<p:ajax event="rowSelect" update=":listForm:netDialog"
								
								oncomplete="PF('netDialogWid').show()" />
							<p:column headerText="ID">
								<h:outputText value="#{net.id}" />
							</p:column>
							<p:column headerText="Status">
								<h:outputText value="#{net.status}" />
							</p:column>
						</p:dataTable>
					</p:tab>
				</p:accordionPanel>
				
				<!-- Edit existing circle -->
				<p:dialog id="netDialog" widgetVar="netDialogWid" modal="true"
					header="Info Fischernetz #{fishingNetController.selectedNet.id}">
					<h:panelGrid columns="2" cellpadding="5">
						<h:outputText value="Breitengrad:" />
						<h:outputText value="#{fishingNetController.selectedNet.latitude}" />
						<h:outputText value="Längengrad:" />
						<h:outputText
							value="#{fishingNetController.selectedNet.longitude}" />
						<h:outputText value="Radius:" />
						<h:outputText value="#{fishingNetController.selectedNet.area}" />
						<h:outputText value="Status:" />
						<h:outputText value="#{fishingNetController.selectedNet.status}" />

						<h:outputText rendered="#{fishingNetController.showName}"
							value="Name:" />
						<p:inputText rendered="#{fishingNetController.showName}" id="name"
							value="#{fishingNetController.currentUser.name}"
							validatorMessage="Bitte nur Buchstaben verwenden."
							required="true">
							<f:validateRegex pattern="^[A-Za-z]+$" />
							<p:ajax event="blur" process="@this" update="messages" />
						</p:inputText>

						<h:outputText rendered="#{fishingNetController.showNext}"
							value="Telefonnummer:" />
						<p:inputText rendered="#{fishingNetController.showNext}"
							id="mobile" value="#{fishingNetController.currentUser.mobile}"
							validatorMessage="Bitte nur Ziffern verwenden." required="true">
							<f:validateRegex pattern="^[0-9]+$" />
							<p:ajax event="blur" process="@this" update="messages" />
						</p:inputText>
					</h:panelGrid>

					<p:commandButton value="Verschollen"
						rendered="#{fishingNetController.showMissing}"
						action="#{fishingNetController.cancelFishingNet}"
						process="@this :listForm:mobile :listForm:name"
						update=":listForm:accordion :listForm:netDialog messages"
						styleClass="ui-button-warning" />

					<p:commandButton
						value="#{fishingNetController.selectedNet.nextStatus}"
						rendered="#{fishingNetController.showNext}"
						action="#{fishingNetController.processFishingNet}"
						process="@this :listForm:mobile :listForm:name"
						update=":listForm:accordion :listForm:netDialog messages"
						styleClass="ui-button-success" />

				</p:dialog>
			</h:form>
		</p:splitterPanel>
		
		<!-- Right side of the website -->
		<p:splitterPanel minSize="90" size="80" style="overflow: hidden;">
								
			<!-- Google Maps -->
			<p:gmap widgetVar="myMap" id="maps" disableDefaultUI="true"
				center="51.1181141, 10.85998582" zoom="5" type="HYBRID"
				style="width: 100%; height: 100%;"
				model="#{fishingNetController.circlesView.circleModel}">
				<p:ajax event="overlaySelect"
					listener="#{fishingNetController.circleSelected}"
					update=":listForm:netDialog" oncomplete="PF('netDialogWid').show()" />
			</p:gmap>
		
			<!-- Adding new circle -->
			<h:form>
				<p:remoteCommand name="callOnStateChange"
					update=":shapeForm:shapeDialog"
					action="#{fishingNetController.onAddingNewCircle}"
					oncomplete="PF('shapeDialogWid').show()">
					<f:param name="centerLat" />
					<f:param name="centerLng" />
					<f:param name="radius" />
				</p:remoteCommand>
			</h:form>
		
			<!-- Edit new circle -->
			<h:form id="shapeForm">
				<p:dialog header="Neuer Eintrag" widgetVar="shapeDialogWid"
					id="shapeDialog" modal="true" closeOnEscape="true"
					resizable="false">
					<h:panelGrid columns="2" cellpadding="5">
						<h:outputText value="Breitengrad " />
						<p:inputText value="#{fishingNetController.fishingNet.latitude}"
							required="true">
							<p:ajax event="blur" process="@this" update="messages" />
						</p:inputText>
						<h:outputText value="Längengrad " />
						<p:inputText value="#{fishingNetController.fishingNet.longitude}"
							required="true">
							<p:ajax event="blur" process="@this" update="messages" />
						</p:inputText>
						<h:outputText value="Radius (km²)" />
						<p:inputText value="#{fishingNetController.fishingNet.area}"
							required="true">
							<p:ajax event="blur" process="@this" update="messages" />
						</p:inputText>
					</h:panelGrid>
					<p:commandButton value="Speichern"
						action="#{fishingNetController.saveNewFishingNet}"
						icon="pi pi-save"
						styleClass="ui-button-raised ui-button-secondary"
						oncomplete="if (!args.validationFailed) PF('shapeDialogWid').hide()"
						update=":listForm:accordion messages" />
				</p:dialog>
			</h:form>
	
		</p:splitterPanel>
	</p:splitter>
	
	<script
        src="https://maps.googleapis.com/maps/api/js?key=&amp;v=weekly&amp;libraries=drawing">
    </script>
</h:body>
</html>